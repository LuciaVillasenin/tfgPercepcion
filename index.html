<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario de Discriminación Auditiva y Visual</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        h1, h2 {
            color: #0056b3;
            text-align: center;
        }
        section {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
        fieldset {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
        legend {
            font-weight: bold;
            color: #0056b3;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .feedback {
            margin-top: 10px;
            color: green;
            font-weight: bold;
        }
        #cuestionario button[type="submit"] {
            display: block;
            margin: 20px auto;
            padding: 15px 30px;
            font-size: 1.2em;
            background-color: #28a745;
        }
        #cuestionario button[type="submit"]:hover {
            background-color: #1e7e34;
        }
        .prueba-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .linea-container {
            height: 100px;
            width: 300px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        .linea {
            display: inline-block;
            height: 2px;
            background-color: #000;
            position: absolute;
            top: 50%;
            left: 0;
            transform-origin: left center;
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            fieldset {
                padding: 10px;
            }
            .linea-container {
                width: 100%;
            }
            .prueba-container {
                flex-direction: column;
                align-items: stretch;
            }
            .prueba-container > div {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>Cuestionario de Discriminación Auditiva y Visual</h1>

    <section>
        <h2>Te doy la bienvenida a este cuestionario</h2>
        <p>
            La siguiente prueba forma parte de mi Trabajo de Fin de Grado que consiste en un estudio sobre percepción
            auditiva y visual. El objetivo es evaluar tu capacidad para discriminar estímulos sonoros y visuales. Este
            cuestionario es totalmente anónimo.
        </p>
        <p>
            Para asegurar la validez de los resultados, es muy importante que realices este cuestionario COMPLETO una
            sola vez. Repetir el cuestionario o hacerlo de forma incompleta afectará negativamente a la calidad de los
            datos y, por lo tanto, a la validez de mi estudio. <strong>Se recomienda el uso de auriculares para su
                realización. Puedes reproducir los sonidos todas las veces que lo necesites.</strong>
        </p>
        <p>
            Por favor, responde a todas las preguntas con atención y honestidad y si detectas algún error en el funcionamiento,
            repórtamelo para que pueda arreglarlo a la mayor brevedad ¡Muchas gracias por tu ayuda!
        </p>
    </section>

    <form id="cuestionario" action="https://formspree.io/f/mnnpnvyb" method="POST">
        <h2>Datos Demográficos</h2>
        <fieldset>
            <legend>Información Personal</legend>

            <label for="edad">Edad:</label>
            <input type="number" id="edad" name="edad" required min="18" max="100"><br><br>

            <label for="sexo">Sexo:</label>
            <select id="sexo" name="sexo" required>
                <option value="">Selecciona una opción</option>
                <option value="masculino">Masculino</option>
                <option value="femenino">Femenino</option>
                <option value="otro">Otro</option>
                <option value="prefiero_no_decir">Prefiero no decir</option>
            </select><br><br>

            <label for="nivel_estudios">Nivel de estudios:</label>
            <select id="nivel_estudios" name="nivel_estudios" required>
                <option value="">Selecciona una opción</option>
                <option value="sin_estudios">Sin estudios</option>
                <option value="educacion_secundaria">Educación Secundaria</option>
                <option value="bachillerato">Bachillerato</option>
                <option value="ciclo_formativo_grado_medio">Ciclo Formativo de Grado Medio</option>
                <option value="ciclo_formativo_grado_superior">Ciclo Formativo de Grado Superior</option>
                <option value="universidad">Universidad</option>
                <option value="master_doctorado">Máster/Doctorado</option>
            </select><br><br>

            <label for="ocupacion">Ocupación:</label>
            <select id="ocupacion" name="ocupacion" required>
                <option value="">Selecciona una opción</option>
                <option value="estudiante">Estudiante</option>
                <option value="empleado">Empleado</option>
                <option value="autonomo">Autónomo</option>
                <option value="desempleado">Desempleado</option>
                <option value="jubilado">Jubilado</option>
                <option value="otro">Otro</option>
            </select><br><br>

            <label for="lateralidad">Lateralidad:</label>
            <select id="lateralidad" name="lateralidad" required>
                <option value="">Selecciona una opción</option>
                <option value="diestro">Diestro</option>
                <option value="zurdo">Zurdo</option>
                <option value="ambidiestro">Ambidiestro</option>
            </select><br><br>

            <label for="problemas_visuales">¿Tienes problemas visuales?</label>
            <select id="problemas_visuales" name="problemas_visuales" required>
                <option value="">Selecciona una opción</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select><br><br>

            <label for="problemas_auditivos">¿Tienes problemas auditivos?</label>
            <select id="problemas_auditivos" name="problemas_auditivos" required>
                <option value="">Selecciona una opción</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select><br><br>

            <label for="experiencia_musical">¿Tienes experiencia musical?</label>
            <select id="experiencia_musical" name="experiencia_musical" required>
                <option value="">Selecciona una opción</option>
                <option value="ninguna">Ninguna</option>
                <option value="aficionado">Aficionado</option>
                <option value="semi_profesional">Semi-profesional</option>
                <option value="profesional">Profesional</option>
            </select>
        </fieldset>

        <!-- Parte 1: Discriminación Auditiva -->
        <h2>Parte 1: Discriminación Auditiva</h2>
        <p>En cada prueba, escucha los sonidos A y B y selecciona cuál es más largo o si son iguales.</p>
        <div id="preguntas"></div>

        <!-- Parte 2: Discriminación de Secuencias -->
        <h2>Parte 2: Discriminación de Secuencias</h2>
        <p>Escucha cada secuencia de sonidos y selecciona cuál es más larga.</p>
        <div id="preguntasSecuencias"></div>

        <!-- Parte 3: Discriminación Visual de la Línea Más Larga -->
        <h2>Parte 3: Discriminación de la Línea Más Larga</h2>
        <p>Selecciona cuál de las líneas es la más larga o si son iguales.</p>
        <div id="preguntasLineas"></div>

        <!-- Parte 4: Discriminación de la Suma de Líneas Más Larga -->
        <h2>Parte 4: Discriminación de la Suma de Líneas Más Larga</h2>
        <p>Selecciona cuál es la suma de líneas más larga o si son iguales.</p>
        <div id="preguntasSumas"></div>

        <button type="submit" id="submitBtn">Enviar Respuestas</button>
    </form>

    <!-- Modal para mostrar segmentos -->
    <div id="modal" class="modal">
        <div id="modal-content"></div>
        <button onclick="cerrarModal()">Cerrar</button>
    </div>
    <div id="modal-overlay" class="modal-overlay"></div>

    <script>
        // Configuración general
        const frecuenciaBase = 440; // Hz

        // Parte 1: Pruebas de tonos
        const pruebasTonos = [ 
            { A: 3150, B: 2835 }, // 3.15, 2.835 (10% diferencia, A > B, Largo)
            { A: 450, B: 300 },   // 0.45, 0.30 (33.3% diferencia, A > B, Corto)
            { A: 1500, B: 1650 }, // 1.5, 1.65 (10% diferencia, A < B, Largo)
            { A: 1000, B: 800 },  // 1.0, 0.80 (20% diferencia, A > B, Corto)
            { A: 2000, B: 2200 }, // 2.0, 2.2 (10% diferencia, A < B, Largo)
            { A: 750, B: 750 },   // 0.75, 0.75 (0% diferencia, A = B, Corto)
            { A: 500, B: 700 },   // 0.50, 0.70 (40% diferencia, A < B, Corto)
            { A: 3000, B: 3300 }, // 3.0, 3.3 (10% diferencia, A < B, Largo)
            { A: 3500, B: 3500 }, // 3.5, 3.5 (0% diferencia, A = B, Largo)
            { A: 900, B: 1100 }   // 0.9, 1.1 (22.2% diferencia, A < B, Corto)
        ];

        // Parte 2: Pruebas de secuencias (Corregida la secuencia 3b)   

          const pruebasSecuencias = [
            { A: [400, 600, 500], B: [350, 450, 400, 500] },
            { A: [300, 500, 400, 600], B: [250, 350, 450, 400, 500] },
            { A: [700, 800, 750], B: [500, 600, 700, 550] },
            { A: [200, 300, 400, 500, 600], B: [180, 280, 380, 480, 580, 680] },
            { A: [450, 550, 600, 700], B: [800, 850, 750] },
            { A: [500, 600, 700], B: [800, 850, 750] },
            { A: [300, 400, 500, 600, 700], B: [250, 350, 450, 500, 650, 700] },
            { A: [600, 700, 800, 900], B: [550, 650, 750, 850, 950] },
            { A: [400, 500, 600], B: [350, 450, 500, 550] },
            { A: [450, 550, 650, 750], B: [600, 700, 800] }
        ];
 
        // Parte 3: Pruebas de la línea más larga
        const pruebasLineas = [
            { A: 200, B: 250 },
            { A: 150, B: 150 },
            { A: 100, B: 80 },
            { A: 220, B: 180 },
            { A: 120, B: 120 },
            { A: 180, B: 200 },
            { A: 250, B: 220 },
            { A: 90, B: 110 },
            { A: 160, B: 160 },
            { A: 210, B: 190 }
        ];

        // Parte 4: Pruebas de la suma de líneas más larga
        const pruebasSumas = [
            { A: [50, 100], B: [40, 80, 50] },
            { A: [80, 120], B: [70, 90, 60] },
            { A: [100, 120, 80], B: [50, 60, 90, 70] },
            { A: [30, 50], B: [60, 80, 40] },
            { A: [70, 70, 70], B: [50, 50, 50, 50] },
            { A: [60, 90], B: [50, 70, 30] },
            { A: [40, 60, 50], B: [70, 30, 40] },
            { A: [80, 80], B: [60, 50, 30] },
            { A: [50, 40, 30], B: [60, 60] },
            { A: [90, 50], B: [40, 40, 40] }
        ];

        let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let playing = false;
        let formSubmitted = false;

        // Función para generar un solo tono
        function generarSonido(duracion, boton) {
            if (playing) return;

            playing = true;
            boton.disabled = true;

            let osc = audioCtx.createOscillator();
            osc.frequency.setValueAtTime(frecuenciaBase, audioCtx.currentTime);
            osc.type = "sine";
            osc.connect(audioCtx.destination);
            osc.start();

            setTimeout(() => {
                osc.stop();
                playing = false;
                boton.disabled = false;
            }, duracion);
        }

        // Función para generar una secuencia de tonos
        function generarSecuencia(duraciones, boton) {
            if (playing) return;

            playing = true;
            boton.disabled = true;

            let startTime = audioCtx.currentTime;
            const intervalo = 0.3; // Intervalo de silencio entre tonos en segundos (300 ms)

            duraciones.forEach((duracion, index) => {
                let tonoStartTime = startTime + index * (duracion / 1000 + intervalo);

                let osc = audioCtx.createOscillator();
                osc.frequency.setValueAtTime(440, tonoStartTime);
                osc.type = "sine";
                osc.connect(audioCtx.destination);
                osc.start(tonoStartTime);
                osc.stop(tonoStartTime + duracion / 1000);
                osc.onended = () => osc.disconnect();
            });

            let totalDuration = duraciones.reduce((sum, duracion) => sum + duracion / 1000, 0) + (duraciones.length - 1) * intervalo;
            setTimeout(() => {
                playing = false;
                boton.disabled = false;
            }, totalDuration * 1000);
        }

        // Función para mostrar una línea en el modal
        function mostrarLinea(largo, titulo) {
            const contenido = `
                <h3>${titulo}</h3>
                <div class="linea-container">
                    <div class="linea" style="width: ${largo}px;"></div>
                </div>
            `;
            abrirModal(contenido);
        }

        // Función para mostrar una suma de líneas en el modal
        function mostrarSuma(segmentos, titulo) {
            let contenido = `<h3>${titulo}</h3>`;
            segmentos.forEach((largo, index) => {
                contenido += `
                    <div class="linea-container">
                        <div class="linea" style="width: ${largo}px;"></div>
                    </div>
                `;
            });
            abrirModal(contenido);
        }

        // Función para abrir el modal
        function abrirModal(contenido) {
            document.getElementById('modal-content').innerHTML = contenido;
            document.getElementById('modal').style.display = 'block';
            document.getElementById('modal-overlay').style.display = 'block';
        }

        // Función para cerrar el modal
        function cerrarModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('modal-overlay').style.display = 'none';
        }

        // Función para crear una pregunta de discriminación auditiva
        function crearPregunta(index, tonoA, tonoB) {
            const div = document.createElement("fieldset");
            div.innerHTML = `
                <legend><strong>Prueba ${index + 1}</strong></legend>
                <div class="prueba-container">
                    <div>
                        <button type="button" onclick="generarSonido(${tonoA}, this)">Reproducir Sonido A</button>
                    </div>
                    <div>
                        <button type="button" onclick="generarSonido(${tonoB}, this)">Reproducir Sonido B</button>
                    </div>
                </div>
                <br>
                <label><input type="radio" name="prueba${index}" value="A" required> A es más largo</label><br>
                <label><input type="radio" name="prueba${index}" value="B"> B es más largo</label><br>
                <label><input type="radio" name="prueba${index}" value="Iguales"> Son iguales</label>
                <div class="feedback" id="feedback${index}"></div>
            `;
            document.getElementById("preguntas").appendChild(div);
        }

        // Función para crear una pregunta de secuencias
        function crearPreguntaSecuencia(index, secuenciaA, secuenciaB) {
            const div = document.createElement("fieldset");
            div.innerHTML = `
                <legend><strong>Prueba ${index + 1}</strong></legend>
                <div class="prueba-container">
                    <div>
                        <button type="button" onclick="generarSecuencia([${secuenciaA}], this)">Reproducir Secuencia A</button>
                    </div>
                    <div>
                        <button type="button" onclick="generarSecuencia([${secuenciaB}], this)">Reproducir Secuencia B</button>
                    </div>
                </div>
                <br>
                <label><input type="radio" name="pruebaSecuencia${index}" value="A" required> A es más larga</label><br>
                <label><input type="radio" name="pruebaSecuencia${index}" value="B"> B es más larga</label><br>
                <label><input type="radio" name="pruebaSecuencia${index}" value="Iguales"> Son iguales</label>
                <div class="feedback" id="feedbackSecuencia${index}"></div>
            `;
            document.getElementById("preguntasSecuencias").appendChild(div);
        }

        // Función para crear una pregunta de líneas
        function crearPreguntaLinea(index, largoA, largoB) {
            const div = document.createElement("fieldset");
            div.innerHTML = `
                <legend><strong>Prueba ${index + 1}</strong></legend>
                <div class="prueba-container">
                    <div>
                        <button type="button" onclick="mostrarLinea(${largoA}, 'A')">Ver Línea A</button>
                    </div>
                    <div>
                        <button type="button" onclick="mostrarLinea(${largoB}, 'B')">Ver Línea B</button>
                    </div>
                </div>
                <br>
                <label><input type="radio" name="pruebaLinea${index}" value="A" required> A es más larga</label><br>
                <label><input type="radio" name="pruebaLinea${index}" value="B"> B es más larga</label><br>
                <label><input type="radio" name="pruebaLinea${index}" value="Iguales"> Son iguales</label>
                <div class="feedback" id="feedbackLinea${index}"></div>
            `;
            document.getElementById("preguntasLineas").appendChild(div);
        }

        // Función para crear una pregunta de sumas de líneas
        function crearPreguntaSuma(index, sumA, sumB) {
            const div = document.createElement("fieldset");
            div.innerHTML = `
                <legend><strong>Prueba ${index + 1}</strong></legend>
                <div class="prueba-container">
                    <div>
                        <button type="button" onclick="mostrarSuma([${sumA}], 'A')">Ver Suma A</button>
                    </div>
                    <div>
                        <button type="button" onclick="mostrarSuma([${sumB}], 'B')">Ver Suma B</button>
                    </div>
                </div>
                <br>
                <label><input type="radio" name="pruebaSuma${index}" value="A" required> A es más larga</label><br>
                <label><input type="radio" name="pruebaSuma${index}" value="B"> B es más larga</label><br>
                <label><input type="radio" name="pruebaSuma${index}" value="Iguales"> Son iguales</label>
                <div class="feedback" id="feedbackSuma${index}"></div>
            `;
            document.getElementById("preguntasSumas").appendChild(div);
        }

        // Generar todas las preguntas
        pruebasTonos.forEach((p, index) => crearPregunta(index, p.A, p.B));
        pruebasSecuencias.forEach((p, index) => crearPreguntaSecuencia(index, p.A, p.B));
        pruebasLineas.forEach((p, index) => crearPreguntaLinea(index, p.A, p.B));
        pruebasSumas.forEach((p, index) => crearPreguntaSuma(index, p.A, p.B));

        // Impedir el envío múltiple del formulario
        document.getElementById('cuestionario').addEventListener('submit', function(event) {
            if (formSubmitted) {
                event.preventDefault();
                alert('Este formulario ya ha sido enviado. Gracias.');
            } else {
                formSubmitted = true;
                document.getElementById('submitBtn').disabled = true;
                document.getElementById('submitBtn').innerText = 'Enviando...';
            }
        });
    </script>
</body>
</html>
